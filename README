# config/initializers/stripe.rb

require 'stripe/model'

if Rails.env.production?
  Stripe.api_key = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
else
  Stripe.api_key = "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
end

STRIPE_PLAN_ID = "some-awesome-plan"
STRIPE_TRIAL_PERIOD = 1.month



# app/controllers/stripe_controller.rb

class StripeController < ApplicationController
  def webhook
    Account.subscription_event(params)
    head :ok
  end
end



# app/controllers/accounts_controller.rb

class AccountsController < ApplicationController
  def cancel
    current_account.subscription_cancel!
    redirect_to settings_account_path, :notice => "Your account has been canceled."
  end

  def reactivate
    current_account.subscription_reactivate!
    redirect_to settings_account_path, :notice => "Your account has been reactivated."
  end
end